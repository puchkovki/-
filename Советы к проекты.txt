¬се макросы ставить внутрь do ... while ()
#define log(str, ...)
do {
...
} while (0);

sizeof вычисл€етс€ на момент компил€ции

ѕосле сборки программы макросы замен€ютс€ макроопределени€ми. ѕри вызове же функции под неЄ выдел€етс€ новый стековый кадр, и она выполн€етс€ самосто€тельно и не зависит от места в коде, откуда была вызвана. ‘ункции выполн€ют проверку типов: если функци€ ожидает на входе строку, а получает число, будет выброшена ошибка (или, по крайней мере, предупреждение, в зависимости от компил€тора). ћакросы в то же врем€ просто замен€ют аргумент, который им передан. явное преимущество макросов перед функци€ми Ч производительность.

–аскрыть макросы "gcc -E source.c"

ƒиректива Ц это указание компил€тору выполнить то или иное действие в момент компил€ции программы.

 ак проверт€ь, что структура данных влезает на страницу? ќшибка должна быть проверена на момент компил€ции. 